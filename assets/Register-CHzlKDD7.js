import{i as L,k as O,b as t,j as e,B as h,L as R}from"./index-uXjfszPq.js";import{c as W,a as i,b as E,u as M,I as f}from"./formik.esm-DxGJtXBs.js";import{V as j,a as S}from"./VisibilityOff-Dz_I50Aw.js";import{L as V,T as $}from"./ThemeSwitcher-DBqbwOkE.js";import{u as z,P as F,T as b,I as k}from"./useTranslation-DjAqwgvE.js";import{C as N,T as d,B as H,S as J,A as U}from"./TextField-CFRbq1Vu.js";import{m as G}from"./proxy-9R1HBaCq.js";import{L as K}from"./Link-CHfWKvqY.js";import"./Tooltip-BVZKaCrU.js";import"./MenuItem-u_sSltQC.js";function ne(){const y=L(),{login:v}=O(),{t:s}=z(),[C,n]=t.useState(!1),[P,l]=t.useState(""),[_,c]=t.useState("success"),[m,T]=t.useState(!1),[u,q]=t.useState(!1),w=()=>{n(!1)},I=W({name:i().required(s("register.name_required")),email:i().email(s("register.email_invalid")).required(s("register.email_required")),password:i().min(6,s("register.password_min")).required(s("register.password_required")),confirmPassword:i().oneOf([E("password"),null],s("register.password_match")).required(s("register.confirm_password_required"))}),r=M({initialValues:{name:"",email:"",password:"",confirmPassword:""},validationSchema:I,onSubmit:async o=>{try{const a=await fetch("http://147.232.205.77:8000/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:o.email,full_name:o.name,password:o.password})});if(a.ok){const A=await a.json(),x=await fetch("http://147.232.205.77:8000/auth/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({username:o.email,password:o.password})});if(!x.ok)throw new Error("Invalid login after registration");const p=await x.json();if(typeof p.access_token!="string")throw new Error("Invalid token format received");localStorage.setItem("token",p.access_token),v(A,p.access_token),l(s("register.registration_success")),c("success"),n(!0),y("/app/home")}else if(a.status===400)l(s("register.email_exists")),c("error"),n(!0);else throw new Error("Registration error")}catch(a){console.error(a),l(s("common.error_occurred")||"An error occurred during registration."),c("error"),n(!0)}}}),B=()=>{T(o=>!o)},D=()=>{q(o=>!o)},g=o=>{o.preventDefault()};return e.jsx(N,{component:"main",maxWidth:"xs",children:e.jsxs(G.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{duration:.5},children:[e.jsx(F,{elevation:3,sx:{padding:4,mt:8,position:"relative",zIndex:1},children:e.jsxs(h,{sx:{display:"flex",flexDirection:"column",alignItems:"center"},children:[e.jsx(b,{component:"h1",variant:"h5",children:s("register.title")}),e.jsxs(h,{component:"form",onSubmit:r.handleSubmit,sx:{mt:1},children:[e.jsx(d,{margin:"normal",required:!0,fullWidth:!0,id:"name",name:"name",label:s("register.name"),type:"text",value:r.values.name,onChange:r.handleChange,error:r.touched.name&&!!r.errors.name,helperText:r.touched.name&&r.errors.name}),e.jsx(d,{margin:"normal",required:!0,fullWidth:!0,id:"email",name:"email",label:s("register.email"),type:"email",value:r.values.email,onChange:r.handleChange,error:r.touched.email&&!!r.errors.email,helperText:r.touched.email&&r.errors.email}),e.jsx(d,{margin:"normal",required:!0,fullWidth:!0,id:"password",name:"password",label:s("register.password"),type:m?"text":"password",value:r.values.password,onChange:r.handleChange,error:r.touched.password&&!!r.errors.password,helperText:r.touched.password&&r.errors.password,InputProps:{endAdornment:e.jsx(f,{position:"end",children:e.jsx(k,{"aria-label":s(m?"password.hide":"password.show"),onClick:B,onMouseDown:g,edge:"end",sx:{cursor:"pointer"},children:m?e.jsx(j,{}):e.jsx(S,{})})})}}),e.jsx(d,{margin:"normal",required:!0,fullWidth:!0,id:"confirmPassword",name:"confirmPassword",label:s("register.confirm_password"),type:u?"text":"password",value:r.values.confirmPassword,onChange:r.handleChange,error:r.touched.confirmPassword&&!!r.errors.confirmPassword,helperText:r.touched.confirmPassword&&r.errors.confirmPassword,InputProps:{endAdornment:e.jsx(f,{position:"end",children:e.jsx(k,{"aria-label":s(u?"password.hide":"password.show"),onClick:D,onMouseDown:g,edge:"end",sx:{cursor:"pointer"},children:u?e.jsx(j,{}):e.jsx(S,{})})})}}),e.jsx(H,{type:"submit",fullWidth:!0,variant:"contained",color:"primary",sx:{mt:3,mb:2,cursor:"pointer"},children:s("register.submit")}),e.jsxs(b,{variant:"body2",align:"center",children:[s("register.have_account")," ",e.jsx(K,{component:R,to:"/",sx:{cursor:"pointer"},children:s("register.login")})]})]})]})}),e.jsxs(h,{sx:{display:"flex",justifyContent:"center",gap:2,mt:2},children:[e.jsx(V,{}),e.jsx($,{})]}),e.jsx(J,{open:C,autoHideDuration:6e3,onClose:w,anchorOrigin:{vertical:"bottom",horizontal:"center"},children:e.jsx(U,{onClose:w,severity:_,sx:{width:"100%"},children:P})})]})})}export{ne as default};
