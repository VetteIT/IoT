import{j as o,g as _,a as F,s as q,r as A,c as S,m as D,b as r,u as E,d as H,e as U,f as P,h as B,i as W,k as N,B as C,L as J,l as Z}from"./index-uXjfszPq.js";import{c as G,a as $,u as K,I as Q}from"./formik.esm-DxGJtXBs.js";import{V as X,a as Y}from"./VisibilityOff-Dz_I50Aw.js";import{L as ee,T as oe}from"./ThemeSwitcher-DBqbwOkE.js";import{c as I,u as te,P as se,T as M,I as ae}from"./useTranslation-DjAqwgvE.js";import{C as ne,T as R,B as re,S as ie,A as ce}from"./TextField-CFRbq1Vu.js";import{m as le}from"./proxy-9R1HBaCq.js";import{S as de,F as pe}from"./FormControlLabel-8qGP0tEa.js";import{L as me}from"./Link-CHfWKvqY.js";import"./Tooltip-BVZKaCrU.js";import"./MenuItem-u_sSltQC.js";const ue=I(o.jsx("path",{d:"M19 5v14H5V5h14m0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z"}),"CheckBoxOutlineBlank"),he=I(o.jsx("path",{d:"M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.11 0 2-.9 2-2V5c0-1.1-.89-2-2-2zm-9 14l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"}),"CheckBox"),xe=I(o.jsx("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-2 10H7v-2h10v2z"}),"IndeterminateCheckBox");function fe(e){return _("MuiCheckbox",e)}const j=F("MuiCheckbox",["root","checked","disabled","indeterminate","colorPrimary","colorSecondary","sizeSmall","sizeMedium"]),be=e=>{const{classes:s,indeterminate:t,color:i,size:c}=e,p={root:["root",t&&"indeterminate",`color${S(i)}`,`size${S(c)}`]},m=U(p,fe,s);return{...s,...m}},ge=q(de,{shouldForwardProp:e=>A(e)||e==="classes",name:"MuiCheckbox",slot:"Root",overridesResolver:(e,s)=>{const{ownerState:t}=e;return[s.root,t.indeterminate&&s.indeterminate,s[`size${S(t.size)}`],t.color!=="default"&&s[`color${S(t.color)}`]]}})(D(({theme:e})=>({color:(e.vars||e).palette.text.secondary,variants:[{props:{color:"default",disableRipple:!1},style:{"&:hover":{backgroundColor:e.vars?`rgba(${e.vars.palette.action.activeChannel} / ${e.vars.palette.action.hoverOpacity})`:P(e.palette.action.active,e.palette.action.hoverOpacity)}}},...Object.entries(e.palette).filter(B()).map(([s])=>({props:{color:s,disableRipple:!1},style:{"&:hover":{backgroundColor:e.vars?`rgba(${e.vars.palette[s].mainChannel} / ${e.vars.palette.action.hoverOpacity})`:P(e.palette[s].main,e.palette.action.hoverOpacity)}}})),...Object.entries(e.palette).filter(B()).map(([s])=>({props:{color:s},style:{[`&.${j.checked}, &.${j.indeterminate}`]:{color:(e.vars||e).palette[s].main},[`&.${j.disabled}`]:{color:(e.vars||e).palette.action.disabled}}})),{props:{disableRipple:!1},style:{"&:hover":{"@media (hover: none)":{backgroundColor:"transparent"}}}}]}))),ke=o.jsx(he,{}),ve=o.jsx(ue,{}),we=o.jsx(xe,{}),Ce=r.forwardRef(function(s,t){const i=E({props:s,name:"MuiCheckbox"}),{checkedIcon:c=ke,color:p="primary",icon:m=ve,indeterminate:l=!1,indeterminateIcon:f=we,inputProps:u,size:h="medium",disableRipple:x=!1,className:y,...b}=i,g=l?f:m,k=l?f:c,v={...i,disableRipple:x,color:p,indeterminate:l,size:h},a=be(v);return o.jsx(ge,{type:"checkbox",inputProps:{"data-indeterminate":l,...u},icon:r.cloneElement(g,{fontSize:g.props.fontSize??h}),checkedIcon:r.cloneElement(k,{fontSize:k.props.fontSize??h}),ownerState:v,ref:t,className:H(a.root,y),disableRipple:x,...b,classes:a})});function Te(){const e=W(),{login:s}=N(),{t}=te(),[i,c]=r.useState(!1),[p,m]=r.useState(""),[l,f]=r.useState("success"),[u,h]=r.useState(!1),[x,y]=r.useState(!1),b=()=>{c(!1)},g=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,k=/^[A-Za-z0-9._-]{3,16}$/,v=G({identifier:$().required(t("login.identifier_required")).test("is-email-or-username",t("login.identifier_invalid"),function(n){if(!n)return!1;const d=g.test(n),z=k.test(n);return d||z}),password:$().min(6,t("login.password_min")).required(t("login.password_required"))}),a=K({initialValues:{identifier:"",password:""},validationSchema:v,onSubmit:async n=>{try{const d=await fetch("http://147.232.205.77:8000/auth/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({username:n.identifier,password:n.password})});if(!d.ok)throw new Error("Invalid credentials");const w=(await d.json()).access_token,V=Z(w);x?localStorage.setItem("token",w):sessionStorage.setItem("token",w),s(V,w),e("/app/home")}catch(d){console.error(d),m(t("login.invalid_credentials")),f("error"),c(!0)}finally{}}}),O=()=>{h(n=>!n)},T=n=>{n.preventDefault()},L=n=>{y(n.target.checked)};return o.jsx(ne,{component:"main",maxWidth:"xs",children:o.jsx(C,{sx:{mt:4},children:o.jsxs(le.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{duration:.5},children:[o.jsx(se,{elevation:3,sx:{padding:4,mt:8,position:"relative",zIndex:1},children:o.jsxs(C,{sx:{display:"flex",flexDirection:"column",alignItems:"center"},children:[o.jsx(M,{component:"h1",variant:"h5",children:t("login.title")}),o.jsxs(C,{component:"form",onSubmit:a.handleSubmit,sx:{mt:1},children:[o.jsx(R,{margin:"normal",required:!0,fullWidth:!0,id:"identifier",name:"identifier",label:t("login.identifier"),value:a.values.identifier,onChange:a.handleChange,error:a.touched.identifier&&!!a.errors.identifier,helperText:a.touched.identifier&&a.errors.identifier}),o.jsx(R,{margin:"normal",required:!0,fullWidth:!0,id:"password",name:"password",label:t("login.password"),type:u?"text":"password",value:a.values.password,onChange:a.handleChange,error:a.touched.password&&!!a.errors.password,helperText:a.touched.password&&a.errors.password,InputProps:{endAdornment:o.jsx(Q,{position:"end",children:o.jsx(ae,{"aria-label":t(u?"password.hide":"password.show"),onClick:O,onMouseDown:T,edge:"end",children:u?o.jsx(X,{}):o.jsx(Y,{})})})}}),o.jsx(pe,{control:o.jsx(Ce,{checked:x,onChange:L,color:"primary"}),label:t("login.remember_me")}),o.jsx(re,{type:"submit",fullWidth:!0,variant:"contained",color:"primary",sx:{mt:3,mb:2},children:t("login.submit")}),o.jsxs(M,{variant:"body2",align:"center",children:[t("login.no_account")," ",o.jsx(me,{component:J,to:"/register",children:t("login.register")})]})]})]})}),o.jsxs(C,{sx:{display:"flex",justifyContent:"center",gap:2,mt:2},children:[o.jsx(ee,{}),o.jsx(oe,{})]}),o.jsx(ie,{open:i,autoHideDuration:6e3,onClose:b,anchorOrigin:{vertical:"bottom",horizontal:"center"},children:o.jsx(ce,{onClose:b,severity:l,sx:{width:"100%"},children:p})})]})})})}export{Te as default};
